<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Chatbot Municipal - Contexto</title>
  <link rel="icon" href="{{ url_for('static', filename='images/chatbot-icon.png') }}" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
</head>
{% if 'admin_id' not in session %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <script>
                window.location.href = "{{ url_for('login') }}";
            </script>
        {% endif %}
    {% endwith %}
{% endif %}
<body>
  <div class="layout">
    <aside>
      <h2>Menu</h2>
            <ul>
        <li id="menuContexto" class="active" onclick="window.location.href='{{ url_for('admin.contexto') }}'">Contexto</li>
        <li id="menuRecursos" onclick="window.location.href='{{ url_for('admin.index') }}'">Recursos</li>
        <li id="menuRespostas" onclick="window.location.href='{{ url_for('admin.respostas') }}'">FAQs</li>
        <li id="menuNaoRespondidas" onclick="window.location.href='{{ url_for('admin.nao_respondidas') }}'">
          Não respondidas
        </li>
        <li id="menuMetricas" onclick="window.location.href='{{ url_for('admin.metricas') }}'">Métricas</li>
      </ul>
    </aside>
    <div class="content">
      <header>
        <div class="bot-info">
          <img src="{{ url_for('static', filename='images/chatbot-icon.png') }}" alt="bot">
          <div>
            <strong>AI4APGovernance - Inteligência Artificial para a Governança da Administração Pública</strong>
            <div class="bot-subtext">Chatbot Municipal</div>
          </div>
        </div>
        <button id="publicarBtn" onclick="window.location.href='{{ url_for('auth.logout') }}'">Sair</button>
      </header>
      <div class="panel">
        <div id="indicadorAtivo" style="display: none;" class="ativo-indicador"></div>
        <div id="secaoContexto" class="secao left-content" style="display: block !important;">
          <h2>IPVC plataforma de criação de Assistentes Virtuais (chatbots)</h2>
          <h3>Introdução</h3>
          <p>Os assistentes virtuais com capacidade de resposta automatizada têm contribuído significativamente graças à integração de técnicas como o Processamento de Linguagem Natural, Sistemas Baseados em Regras e Modelos de IA Generativa. Este documento descreve a arquitetura geral de um sistema de chatbot inteligente que combina diferentes abordagens para garantir respostas rápidas, relevantes e contextuais, conforme a complexidade da questão colocada pelo utilizador.</p>
          <p>A solução baseia-se num fluxo que integra o carregamento de conteúdos, a indexação semântica e diferentes estratégias de formulação de resposta, incluindo mecanismos baseados em regras, pesquisa por similaridade semântica (FAISS) e geração aumentada por recuperação de dados (RAG) suportada por Modelos de Linguagem de Grande Escala (LLMs).</p>
          <h3>Arquitetura do Sistema</h3>
          <p>A arquitetura do sistema de resposta automatizada com chatbot assenta em dois pontos fundamentais:</p>
          <ol>
            <li><strong>Carregamento e Indexação de Conteúdos</strong>
              <p>O primeiro passo envolve o carregamento de documentos relevantes (por exemplo, ficheros PDF) que contêm a informação essencial para o funcionamento do sistema. Estes documentos são processados e convertidos em vetores semânticos através de modelos de embeddings. Os vetores gerados são armazenados de acordo com a abordagem selecionada:</p>
              <ul>
                <li><strong>Modo Baseado em Regras:</strong> A plataforma oferece uma interface de backoffice onde é possível categorizar FAQs (em texto ou PDF), associando palavras-chave e categorias para posterior consulta estruturada.</li>
                <li><strong>Modo FAISS (Facebook AI Similarity Search):</strong> Os vetores são indexados num motor de pesquisa por similaridade semântica — FAISS — permitindo uma recuperação mais próxima baseada em proximidade semântica. Mais informações.</li>
                <li><strong>Modo RAG (Retrieval-Augmented Generation):</strong> Os vetores são armazenados num modelo de dados vetorial como ChromaDB, otimizando a recuperação de informação contextual para informações.</li>
              </ul>
            </li>
            <li><strong>Processamento de Perguntas dos Utilizadores</strong>
              <p>Quando o utilizador coloca uma questão ao chatbot, esta é encaminhada para o módulo de de comportamento conversacional (Chat Behavior), responsável por determinar a estratégia de resposta mais adequada tendo em conta o tipo de questão e o contexto da interação.</p>
              <p>O sistema pode operar em três modos distintos:</p>
              <ul>
                <li><strong>Modo Baseado em Regras:</strong> Utiliza uma lógica fixa para categorizar a questão com base em palavras-chave normalizadas. Após a categorização, consulta-se uma base de dados estruturada de FAQs, atribuindo pontuações às respostas e apresentando a mais adequada. Ideal para perguntas diretas e padronizadas.</li>
                <li><strong>Modo FAISS:</strong> Para perguntas diretas e não enquadradas em regras fixas, mas onde existe similaridade semântica, o sistema converte a questão num vetor e compara-o com os índices FAISS. Após verificar o limiar de similaridade, apresenta-se a resposta mais próxima com base na informação previamente carregada.</li>
                <li><strong>Modo LLM + RAG:</strong> Para questões complexas ou abertas, o sistema recorre a uma abordagem de IA Generativa. A questão serve de base para recuperar documentos contextuais da ChromaDB, que são combinados num prompt estruturado e enviados a um Modelo de Linguagem de Grande Escala (por exemplo, Ollama). Este gera uma resposta personalizada e contextualizada.</li>
              </ul>
            </li>
          </ol>
          <h3>Geração e Entrega de Respostas</h3>
          <p>Independentemente do modo interno utilizado, a resposta final é gerada e entregue ao utilizador através do módulo de respostas (Bot Answer), garantindo:</p>
          <ul>
            <li>Respostas rápidas e estruturadas (modo baseado em regras)</li>
            <li>Respostas semanticamente relevantes (modo FAISS)</li>
            <li>Respostas altamente contextualizadas e personalizadas (modo RAG + LLM)</li>
          </ul>
          <p>Por defeito, o chatbot privilegia o modo baseado em regras, oferecendo respostas rápidas e consistentes a questões frequentes. Sempre que o sistema deteta a necessidade de maior profundidade ou nuance — pelo tipo de pergunta ou comportamento da conversa — ativa automaticamente técnicas avançadas, incluindo IA Generativa suportada por LLMs, através da abordagem RAG.</p>
          <img src="{{ url_for('static', filename='images/img.png') }}" alt="Fluxograma de Geração de Respostas" style="max-width: 100%; margin-bottom: 15px;">
          <h3>Base de Dados</h3>
          <p>A componente de base de dados desempenha um papel central na arquitetura do Assistente Virtual, sendo responsável pela gestão e armazenamento da informação que suporta as respostas automáticas do sistema. A escolha e configuração das bases de dados variam conforme o modo de funcionamento do chatbot e o tipo de dados envolvidos.</p>
          <h4>Tipos de Bases de Dados Utilizadas</h4>
          <p>O sistema integra diferentes soluções de bases de dados, otimizadas para os distintos modos operacionais:</p>
          <ul>
            <li><strong>Base de Dados Estruturada para FAQs (Modo Baseado em Regras):</strong> Utiliza-se uma base de dados relacional ou documental, onde se armazenam as perguntas frequentes (FAQs) e respetivas respostas, associadas a categorias e palavras-chave. Esta estrutura permite consultas rápidas e eficazes através de mecanismos de normalização de termos e correspondência direta.</li>
            <li><strong>Base de Dados Vetorial FAISS (Modo Semântico):</strong> Para o motor de pesquisa por similaridade, é utilizada a biblioteca FAISS, desenvolvida pela Meta (Facebook). Esta tecnologia permite indexar vetores semânticos derivados dos documentos, facilitando a recuperação eficiente de informação com base em proximidade vetorial e correspondência semântica. A FAISS armazena e gere os dados de forma otimizada para garantir tempos de resposta rápidos mesmo em grandes volumes de informação.</li>
            <li><strong>Base de Dados Vetorial ChromaDB (Modo RAG + LLM):</strong> No contexto de respostas geradas por IA Generativa, o sistema recorre ao ChromaDB, uma base de dados vetorial desenhada especificamente para armazenar embeddings de texto e suportar cenários de Recuperação Aumentada por Geração (RAG). Esta base permite a combinação de documentos contextuais relevantes com os modelos de linguagem de grande escala (LLMs), como o Ollama, garantindo que as respostas geradas sejam altamente relevantes e adaptadas ao contexto.</li>
          </ul>
          <h4>Considerações de Desempenho e Segurança</h4>
          <p>Para garantir a eficiência e segurança do sistema:</p>
          <ul>
            <li>As bases de dados estão configuradas para suportar alta disponibilidade e escalabilidade, assegurando um desempenho consistente mesmo sob carga elevada.</li>
            <li>Implementam-se mecanismos de encriptação e controlo de acesso para proteger a integridade confidencial da informação, especialmente em ambientes com dados sensíveis ou institucionais.</li>
            <li>Os processos de indexação são automatizados, permitindo que novos conteúdos sejam facilmente integrados no sistema, mantendo a base de dados atualizada sem interrupções no serviço.</li>
          </ul>
          <h3>3.3. Modelo de Base de Dados</h3>
          <p>De acordo com os requisitos funcionais e não funcionais, bem como com o objetivo do assistente virtual no contexto do comportamento baseado em regras, apresenta-se a estrutura da base de dados, ilustrada na Figura 3.</p>
          <img src="{{ url_for('static', filename='images/img_2.png') }}" alt="Modelo de Base de Dados para Comportamento Baseado em Regras" style="max-width: 100%; margin-bottom: 15px;">
          <p>As principais entidades do modelo incluem:</p>
          <ul>
            <li><strong>Utilizador (User):</strong> Armazena informações sobre os utilizadores do sistema, incluindo credenciais de acesso e permissões de administrador.</li>
            <li><strong>Chatbot:</strong> Entidade central que representa cada instância de chatbot, com atributos como designação, estado (ativo/inativo), comportamento e categorias associadas.</li>
            <li><strong>FAQ (Perguntas Frequentes):</strong> Contém perguntas e respostas associadas a cada chatbot, suportando conteúdos em vários idiomas.</li>
            <li><strong>Documento:</strong> Representa as fontes de conhecimento (ficheiros, URLs, etc.) associadas as FAQs e aos chatbots.</li>
            <li><strong>Doc_FAQ:</strong> Tabela de junção que estabelece uma relação muitos-para-muitos entre documentos e FAQs.</li>
            <li><strong>Categoria:</strong> Define as classificações temáticas ou linguísticas, agrupando FAQs e chatbots de forma estruturada.</li>
            <li><strong>Chat_Category:</strong> Permite que cada chatbot pertença a múltiplas categorias, através de uma relação muitos-para-muitos.</li>
            <li><strong>Registro (Log):</strong> Registra todas as interações dos utilizadores, incluindo as perguntas colocadas, as respostas do bot e as avaliações de precisão.</li>
          </ul>
          <p>Este modelo de dados garante escalabilidade, suporte multilíngue, rastreabilidade e uma gestão eficiente do conhecimento reutilizável entre diferentes instâncias de chatbot.</p>
        </div>
      </div>
    </div>
  </div>
    <div class="chat-sidebar" id="chatSidebar" style="display: none;">
    <div class="chat-header">
      <button class="chat-close-btn" onclick="fecharChat()">?</button>
      <img src="{{ url_for('static', filename='images/chatbot-icon.png') }}" alt="Chatbot" class="chat-header-avatar">
      <div class="chat-header-info">
        <h3 id="chatHeaderNomeBot"></h3>
        <div id="chatFonteBadge"></div>
      </div>
    </div>
    <div class="chat-layout">
      <aside class="chat-avatar-card">
        <div class="avatar-top-row">
          <div class="avatar-name">Maria</div>
          <button type="button" class="avatar-toggle-btn" id="toggleAvatar">Desligar avatar</button>
        </div>
        <div class="avatar-photo-wrap">
          <img src="{{ url_for('static', filename='images/image.png') }}" alt="Assistente virtual" class="avatar-photo">
        </div>
        <div class="avatar-quick-questions">
          <button type="button" data-question="Como consulto as atas?">Como consulto as atas?</button>
          <button type="button" data-question="Onde posso encontrar o PDM?">Onde posso encontrar o PDM?</button>
          <button type="button" data-question="Que concursos de pessoal est?o abertos?">Que concursos de pessoal est?o abertos?</button>
        </div>
        <button type="button" class="avatar-reset-btn" id="avatarResetChat">Reiniciar Conversa</button>
      </aside>
      <div class="chat-thread">
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input">
          <input type="text" placeholder="Digite uma mensagem..." id="chatInput" onkeydown="if(event.key==='Enter') enviarPergunta()">
          <button onclick="enviarPergunta()" title="Enviar">?</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Botão para abrir o chat -->
  <button id="chatToggleBtn" class="chat-toggle-btn">
    <img src="{{ url_for('static', filename='images/icon-botao.png') }}" alt="Chatbot">
  </button>
  <!-- Rodapé -->
  <footer class="rodape">
    <div class="rodape-content">
      <span>O Projeto é cofinanciado por:</span>
      <div class="rodape-logos">
        <img src="{{ url_for('static', filename='images/prr.png') }}" alt="PRR" class="logo-prr">
        <img src="{{ url_for('static', filename='images/pt.png') }}" alt="República Portuguesa" class="logo-pt">
        <img src="{{ url_for('static', filename='images/ue.png') }}" alt="União Europeia" class="logo-ue">
      </div>
    </div>
  </footer>
  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/globals.js') }}"></script>
  <script src="{{ url_for('static', filename='js/faq.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chatbot-bots.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chatbot-faq.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/navigation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/toggleChat.js') }}"></script>
</body>
</html>