<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Chatbot Municipal - Perguntas não respondidas</title>
  <link rel="icon" href="{{ url_for('static', filename='images/chatbot-icon.png') }}" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
</head>

{# Proteção simples de sessão admin #}
{% if 'admin_id' not in session %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <script>
                window.location.href = "{{ url_for('login') }}";
            </script>
        {% endif %}
    {% endwith %}
{% endif %}

<body>
  <div class="layout">
    <aside>
      <h2>Menu</h2>
            <ul>
        <li id="menuContexto" onclick="window.location.href='{{ url_for('admin.contexto') }}'">Contexto</li>
        <li id="menuRecursos" onclick="window.location.href='{{ url_for('admin.index') }}'">Recursos</li>
        <li id="menuRespostas" onclick="window.location.href='{{ url_for('admin.respostas') }}'">FAQs</li>
        <li id="menuNaoRespondidas" class="active" onclick="window.location.href='{{ url_for('admin.nao_respondidas') }}'">
          Não respondidas
        </li>
        <li id="menuMetricas" onclick="window.location.href='{{ url_for('admin.metricas') }}'">Métricas</li>
      </ul>
    </aside>

    <div class="content">
      <header>
        <div class="bot-info">
          <img src="{{ url_for('static', filename='images/chatbot-icon.png') }}" alt="bot">
          <div>
            <strong>AI4APGovernance - Inteligência Artificial para a Governança da Administração Pública</strong>
            <div class="bot-subtext">Chatbot Municipal</div>
          </div>
        </div>
        <button id="sairBtn" onclick="window.location.href='{{ url_for('auth.logout') }}'">Sair</button>
      </header>

      <div class="panel">
        <div id="indicadorAtivo" style="display: none;" class="ativo-indicador"></div>

        <div id="secaoNaoRespondidas" class="secao left-content" style="display: block !important;">
          <h2>Perguntas não respondidas</h2>

          <!-- Filtros -->
          <div id="filtrosNaoRespondidas" style="display: flex; gap: 16px; align-items: center; margin-bottom: 16px;">
            <input
              type="text"
              id="pesquisaNaoRespondida"
              placeholder="Pesquisar pela pergunta..."
              style="flex: 2; max-width: 340px;"
            >

            <select id="filtroChatbotNaoResp" style="flex: 1; max-width: 200px;">
              <option value="">Todos os Chatbots</option>
            </select>

            <select id="filtroEstadoNaoResp" style="flex: 1; max-width: 180px;">
              <option value="">Todos os estados</option>
              <option value="pendente">Pendentes</option>
              <option value="tratada">Tratadas</option>
              <option value="ignorada">Ignoradas</option>
            </select>
          </div>

          <div id="tituloNaoRespondidas" style="margin-bottom: 12px; color: #4b4b4b;">
          </div>

          <div id="listaNaoRespondidas" style="margin-top: 20px;">
            {# O JS vai preencher esta div com cartões/linhas de perguntas #}
          </div>
        </div>
      </div>
    </div>
  </div>

 
    <div class="chat-sidebar" id="chatSidebar" style="display: none;">
    <div class="chat-header">
      <button class="chat-close-btn" onclick="fecharChat()">?</button>
      <img src="{{ url_for('static', filename='images/chatbot-icon.png') }}" alt="Chatbot" class="chat-header-avatar">
      <div class="chat-header-info">
        <h3 id="chatHeaderNomeBot"></h3>
        <div id="chatFonteBadge"></div>
      </div>
    </div>
    <div class="chat-layout">
      <aside class="chat-avatar-card">
        <div class="avatar-top-row">
          <div class="avatar-name">Maria</div>
          <button type="button" class="avatar-toggle-btn" id="toggleAvatar">Desligar avatar</button>
        </div>
        <div class="avatar-photo-wrap">
          <img src="{{ url_for('static', filename='images/image.png') }}" alt="Assistente virtual" class="avatar-photo">
        </div>
        <div class="avatar-quick-questions">
          <button type="button" data-question="Como consulto as atas?">Como consulto as atas?</button>
          <button type="button" data-question="Onde posso encontrar o PDM?">Onde posso encontrar o PDM?</button>
          <button type="button" data-question="Que concursos de pessoal est?o abertos?">Que concursos de pessoal est?o abertos?</button>
        </div>
        <button type="button" class="avatar-reset-btn" id="avatarResetChat">Reiniciar Conversa</button>
      </aside>
      <div class="chat-thread">
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input">
          <input type="text" placeholder="Digite uma mensagem..." id="chatInput" onkeydown="if(event.key==='Enter') enviarPergunta()">
          <button onclick="enviarPergunta()" title="Enviar">?</button>
        </div>
      </div>
    </div>
  </div>

  <button id="chatToggleBtn" class="chat-toggle-btn">
    <img src="{{ url_for('static', filename='images/icon-botao.png') }}" alt="Chatbot">
  </button>

  <div id="modalTratarPergunta" class="modal-overlay" style="display: none;">
    <div class="modal-box">
      <h2>Tratar pergunta não respondida</h2>
      <p id="perguntaSelecionadaTexto" style="margin-bottom: 12px;"></p>

      <label for="acaoPergunta" style="display:block;margin-bottom:8px;">Ação</label>
      <select id="acaoPergunta" class="input-lg" style="width:100%;max-width:100%;">
        <option value="criar_faq">Criar nova FAQ</option>
        <option value="marcar_tratada">Marcar como tratada</option>
        <option value="marcar_ignorada">Marcar como ignorada</option>
      </select>

      <div class="btn-bar" style="margin-top: 20px;">
        <button id="confirmarTratarPergunta">Confirmar</button>
        <button id="cancelarTratarPergunta" class="btn-cancelar">Cancelar</button>
      </div>
    </div>
  </div>

  <footer class="rodape">
    <div class="rodape-content">
      <span>O Projeto é cofinanciado por:</span>
      <div class="rodape-logos">
        <img src="{{ url_for('static', filename='images/prr.png') }}" alt="PRR" class="logo-prr">
        <img src="{{ url_for('static', filename='images/pt.png') }}" alt="República Portuguesa" class="logo-pt">
        <img src="{{ url_for('static', filename='images/ue.png') }}" alt="União Europeia" class="logo-ue">
      </div>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/globals.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chatbot-bots.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chatbot-faq.js') }}"></script>
  <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/navigation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/toggleChat.js') }}"></script>

  <script src="{{ url_for('static', filename='js/nao-respondidas.js') }}"></script>
</body>
</html>
